@{
    ViewBag.Title = "Home Page";
}


<div class="container-fluid">
    <div class="row" id="Currentbid">
        <div class="col-sm-12">
            <div class="jumbotron">
                <h2>Current Highest Bid: <strong id="HigestBid"></strong></h2>
            </div>
        </div>
    </div>
    <form id="mainForm" action="/Home/sumbitBid" method="post">
        @Html.ValidationSummary()
        <div id="form-row" class="row">
            <div class="col-sm-4">
                <label>Name</label>
            </div>
            <div class="col-sm-8">
                <input type="text" class="form-control Max-input-size" id="name">
            </div>
        </div>
        <div id="form-row" class="row">
            <div class="col-sm-4">
                <label>Phone Number</label>
            </div>
            <div class="col-sm-8">
                <input type="text" class="form-control Max-input-size" data-format="+1 (dd) dddd dddd" id="phone_Number">
            </div>
        </div>
        <div id="form-row" class="row">
            <div class="col-sm-4">
                <label>Email address</label>
            </div>
            <div class="col-sm-8">
                <input type="email" class="form-control Max-input-size" aria-describedby="emailHelp" placeholder="Enter email" id="email">
            </div>
        </div>
        <div id="form-row" class="row">
            <div class="col-sm-4">
                <label>Bid Amount</label>
            </div>
            <div class="col-sm-8">
                <div class="input-group">
                    <span class="input-group-addon">₩</span>
                    <input type="number" class="form-control Max-input-size" data-bind="value:replyNumber" id="bidAmount" min="0" />
                </div>
            </div>
        </div>
        <div id="form-row" class="row">
            <div class="col-sm-4">
                <label>Reason</label>
            </div>
            <div class="col-sm-8">
                <textarea rows="5" class="form-control Max-input-size" id="reason"></textarea>
            </div>
        </div>
        <div id="form-row" class="row">
            <div class="col-sm-4">
                <label>Description</label>
            </div>
            <div class="col-sm-8">
                <textarea rows="5" class="form-control Max-input-size" id="description"></textarea>
            </div>
        </div>
        <div id="form-row" class="row btn-block">
            <div class="col-sm-4 col-sm-offset-4">
                <button type="button" id="btnSubmit" class="btn btn-primary">Submit</button>
            </div>
        </div>
    </form>
</div>
<div id="Alertdiv" style="display:none;">
    <div class="alert alert-success" id="successful">
        <strong>Success!</strong> Bid Successfully
    </div>
    <div class="alert alert-warning" id="over">
        <strong>Warning!</strong> Bidding is over
    </div>

    <div class="alert alert-danger" id="higher">
        <strong>Danger!</strong> Please bid higher than current bid
    </div>
</div>



<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script src="~/Scripts/jquery.signalR-2.2.3.min.js"></script>
<script>
    $(
        function () {
            var con = $.hubConnection();
            var hub = con.createHubProxy('highest_bidHub');
            hub.on('UpdateBid', function (i) {

                $("#HigestBid").text("₩" + i.toLocaleString());
                if (i < 0) //dont show bid 오픈소스 한국
                {
                    $(".jumbotron").hide();
                }
                else {
                    $(".jumbotron").fadeIn("slow");
                }
                //console.log("log: " + i);
            });

            con.start(function () {
                hub.invoke('Send');
            });
        }
    );

    $('#Alertdiv').click(function () {
        $("#Alertdiv").fadeOut("700");
    })

    $('#btnSubmit').click(function () {

        $.ajax({
            url: '@Url.Action("sumbitBid", "Home")',
            data: {
                'bid_amount': $('#bidAmount').val(),
                'email': $('#email').val(),
                'name': $('#name').val(),
                'phone': $('#phone_Number').val(),
                'reason': $('#reason').val(),
                'description': $('#description').val()
            },
            type: "post",
            cache: false,
            success: function (savingStatus) {
                //console.log(savingStatus)
                $('#Alertdiv').fadeIn();
                if (savingStatus == 3) {
                    $("#successful").hide();
                    $("#over").hide();
                    $("#higher").show();
                }
                else if (savingStatus == 2) {
                    $("#successful").hide();
                    $("#over").show();
                    $("#higher").hide();
                }
                else {
                    $("#successful").show();
                    $("#over").hide();
                    $("#higher").hide();
                }

            }
        });
    });

</script>
<style>
    #Currentbid {
        min-height: 189px;
    }

    #Alertdiv {
        position: fixed;
        justify-content: center;
        margin: auto;
        top: 200px;
        left: 40%;
    }

    .btn-primary {
        margin: auto;
        justify-content: center;
        display: flex;
    }

    .Max-input-size {
        max-width: none !important;
    }

    #mainForm {
        max-width: 750px;
        display: block;
        margin: auto;
    }

    #form-row {
        margin: 15px;
    }
</style>